@{
    Layout = "~/Views/Shared/_Layout.cshtml";
}

<script type="text/javascript">
    $(document).ready(function () {
        jQuery.support.cors = true;
        var SERVER = "/api/";
        //$('#select_categories').tokenInput("/api/categories/GetCategories");       

        scAjax({
            "url": "categories/GetCategories",
            "success": function (result) {
                if (!result) {
                    return;
                }

                var categories = result;
                $(categories).each(function (i, category) {
                    var option = $('<option>').text(category.categoryName).val(category.categoryId);
                    $('#select_categories').append(option);
                });
            }
        });

        $('#btn_Save').click(function () {
            var question = $('#txt_question').val();
            var description = $('#txtarea_description').val();
            var categories = $('#select_categories').val();
            if (!question || !description || !categories) {
                return;
            }

            var userDetails = localStorage.getItem("SC_Session_UserDetails");
            if (!userDetails) {
                //TO-DO: Handle if userdetail is not available in Session Storage
                return;
            }

            var userInfo = $.parseJSON(userDetails);            

            var arrCategories = categories.split(',');
            //$.each(categories.split(','), function () {
            //    arrCategories.push($(this).text());
            //});

            var userID = $('#hdnUserID').val();
            var data = {
                "Title": question,
                "Description": description,
                "HasAnswered": 0,
                "UserEmail": userInfo.email,
                "DisplayName": userInfo.firstName,
                "Categories": arrCategories
            };
            //debugger;
            

            scAjax({
                "url": "questions/PostQuestions",
                "type": "POST",
                "data": JSON.stringify(data, null, 2),
                "success": function (result) {
                    if (!result) {
                        return;
                    }

                    document.location.href = "/Feed/Details/" + result.questionId;
                    logActivity(1, result.questionId);
                }
            });

            return false;

        });
    });

    
   
</script>



<h4>Details</h4>
<hr />
    <div class="panel-body">
        <form action="#" class="form-horizontal" method="post" role="form">
            <div class="form-group">
                <label class="control-label col-md-2" for="Question">Question</label>
                <div class="col-md-6">
                    <div class="form-group">
                        <div class="col-md-12">
                            <input class="form-control" id="txt_question" placeholder="What is your question?" type="text" required>
                        </div>
                    </div>
                </div>
            </div>
            <div class="form-group">
                <label class="control-label col-md-2" for="DetailedText">Description</label>
                <div class="col-md-6">
                    <textarea class="form-control" id="txtarea_description" placeholder="Description" rows="3" required></textarea>
                </div>
            </div>            
            <div class="form-group">
                <label class="control-label col-md-2" for="Categories">Categories</label>
                <div class="col-md-6">
                    <div class="form-group">
                        <div class="col-md-12">
                            <input class="form-control" id="select_categories" placeholder="Add categories (,) separeted" type="text" required>
                        </div>
                    </div>
                </div>
            </div>
            @*<div class="form-group">
                <label class="col-md-2 control-label" for="Categories">Categories</label>
                <div class="col-md-6">
                    
                    <div class="form-group">
                        <div class="col-md-12">                           
                            <select class="form-control" id="select_categories" multiple></select>
                        </div>
                    </div>
                    </div>
                </div>*@
            
                    <div class="form-group">
                        <div class="col-md-offset-2 col-md-10">
                            <input type="button" class="btn btn-primary" id="btn_Save" value="Save">
                        </div>
                    </div>
</form>
    </div>

