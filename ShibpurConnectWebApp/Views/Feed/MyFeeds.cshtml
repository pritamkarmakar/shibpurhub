@{
    Layout = "~/Views/Shared/_Layout.cshtml";
}

<style>
    body{
        background: #ECEFF1;
    }
    h1, h2, h3, h4, h5, h6 {
        margin: 0;
        padding: 0;
    }

    .content-area {
        z-index: 190;
        padding-top: 25px;
        /*background: #ECEFF1;*/
        min-height: 1000px;
        padding-bottom: 80px;
        overflow: hidden;
        clear: both;
    }

    .main-content-area {
        /*padding-top: 50px;*/
    }

    .row {
        margin-right: -15px;
        margin-left: -15px;
    }

    .left-side {
        position: relative;
    }

    .feed-list .thread {
        margin-bottom: 25px;
    }

    .thread {
        position: relative;
        font-size: 14px;
        padding: 0 15px;
        border: 0;
        background: #fff;
        box-shadow: 0 1px 3px rgba(0,0,0,.12),0 1px 2px rgba(0,0,0,.24);
        -webkit-border-radius: 4px;
        -moz-border-radius: 4px;
        border-radius: 4px;
        transition: background,.3s,ease-in-out,.3s;
    }

    .post-header {
        background: #FFF;
        background: rgba(176,190,197,.16);
        margin-bottom: 15px;
        border-bottom: 1px solid #ECEFF1;
        padding: 13px 15px;
        overflow: auto;
    }

    .headers-col {
        padding: 0;
    }

    .profile-img-col {
        padding: 0;
        margin-right: 10px;
        float: left;
    }

    a.post-creator-image {
        display: block;
        width: 30px;
        height: 30px;
        -webkit-border-radius: 50%;
        -moz-border-radius: 50%;
        border-radius: 50%;
        overflow: hidden;
        background-color: #f2f2f2;
        background-size: cover;
        background-position: top center;
    }

    .thread .post-header .headers-col .header-text-content {
        line-height: 1;
        margin-bottom: 5px;
        float: left;
        min-width: 80%;
    }

    .thread .post-header p {
        margin: 0;
        padding: 0;
        font-weight: 300;
        color: #263238;
        font-size: 14px;
    }

    .thread .post-header .headers-col .tagline-text-content {
        font-size: 12px;
        color: #78909C;
        margin-bottom: -5px;
        line-height: 1.4;
        width: 85%;
        white-space: nowrap;
        overflow: hidden;
        text-overflow: ellipsis;
        float: left;
    }

    .thread .post-header .topic-icon-placeholder {
        font-size: 12px;
        display: block;
        background: #f2f2f2;
        width: 30px;
        float: right;
        text-align: center;
        color: #FFF;
        -webkit-border-radius: 50%;
        -moz-border-radius: 50%;
        border-radius: 50%;
        padding: 6px 0 3px 0;
        text-decoration: none;
    }

    .thread .topic-icon-placeholder.follow {
        background: #18bc9c;
    }

    .thread .post-header .topic-icon-placeholder i {
        font-size: 16px;
    }

    .thread h2 {
        font-size: 20px;
        font-weight: 400;
        line-height: normal;
        letter-spacing: .12px;
    }

        .thread h2 a {
            display: block;
            color: #263238;
            text-decoration: none;
        }

    .thread .post-description {
        margin-top: 10px;
        margin-bottom: 15px;
        font-weight: 300;
    }

    .post-description p {
        color: #546E7A;
        padding: 0;
        margin: 0;
        font-size: 16px;
    }

    .thread-details {
        border-radius: 4px;
        background: #FFF;
    }
    
    .thread-details-container
    {
        border-top: 1px solid #ECEFF1;
        padding: 10px 0;
        overflow: auto;
    }

    .thread .extra-details {
        font-size: 12px;
        color: #78909C;
        padding-top: 5px;
    }

    .thread .post-link-image-container {
        padding-right: 0;
    }

    .thread .post-link-image-small {
        position: relative;
        display: block;
        overflow: hidden;
        width: 100%;
        height: 120px;
        float: left;
        margin-bottom: 15px;
        background-size: cover;
        background-position: center center;
    }

    .list-inline {
        margin: 0;
        padding: 0;
    }

    .pull-left {
        float: left !important;
    }

    .list-inline {
        list-style: none;
    }

        .list-inline li {
            margin: 0;
            padding: 0 5px;
            float: left;
        }

    .thread .thread-details a.thumbs {
        display: block;
        height: 28px;
        margin-top: 0;
        overflow: hidden;
        margin-right: 10px;
        background: #ECEFF1;
        font-weight: 400;
        padding: 5.2px 12px;
        -webkit-border-radius: 3px;
        -moz-border-radius: 3px;
        border-radius: 3px;
        border-bottom: 2px solid #CFD8DC;
        color: #455A64;
        font-size: 1em;
        text-decoration: none;
        line-height: 1;
        text-align: center;
        -webkit-transition: all,.2s,ease-in-out,.2s;
        -moz-transition: all,.2s,ease-in-out,.2s;
        -ms-transition: all,.2s,ease-in-out,.2s;
        -o-transition: all,.2s,ease-in-out,.2s;
        transition: all,.2s,ease-in-out,.2s;
    }
    
    .thread .thread-details a.thumbs:hover {
        background: #CFD8DC;
        border: 0;
    }
    
    .thread .thread-details a.thumbs.active
    {
        background: #4DB6AC;
        border-bottom: 2px solid #009688;
        color: #fff;
    }
    

    .upvote-ul, .follow-ul
    {
        display: none;
    }

    .thread-details span.gap {
        padding: 7.4px 4px;
        color: #ddd;
        font-weight: 700;
    }

    .thread.loadMoreContainer {
        padding-top: 0;
        padding-bottom: 0;
        background: #FFF;
    }

    .loadMore {
        display: block;
        color: #607D8B;
        font-weight: 400;
        text-decoration: none;
        padding-top: 10px;
        padding-bottom: 10px;
    }

    .post-description.profile dt {
        font-weight: 500;
    }

    #loading{
        text-align: center;
    }

    #loading span
    {
        display:inline-block;
        vertical-align: top;
        padding-top: 5px;
        padding-left: 10px;
    }
</style>
<script type="text/javascript">
    $(document).ready(function () {
        loadFeeds(0);        
    });

    function loadFeeds(page)
    {
        $('#currentPage').val(page);
        var alreadyShown = parseInt($('#alreadyShown').val()) || 0;

        scAjax({
            "url": "feed/GetPersonalizedFeeds",
            "data": { "page": page || 0, "alreadyShown": alreadyShown },
            "success": function (result) {
                if (!result) {
                    return;
                }

                var feeds = result.feedItems;
                $('#alreadyShown').val(result.alreadyProcessedItemCount);

                $(feeds).each(function (index, feed) {
                    if (feed.itemHeader) {
                        var htmlItem = $('div.item.hide').clone().removeClass('hide');

                        var creatorImage = $(htmlItem).find('.post-creator-image');
                        $(creatorImage).attr("href", feed.userProfileUrl).css('background-image', "url(http://i.imgur.com/" + feed.userProfileImageUrl + ")");

                        $(htmlItem).find('a.name-link').text(feed.userName).attr("href", feed.userProfileUrl);

                        $(htmlItem).find('span.action').text(feed.actionText);

                        $(htmlItem).find('a.target').text(feed.targetAction).attr("href", feed.targetActionUrl);

                        $(htmlItem).find('p.designation').text(feed.userDesignation);

                        $(htmlItem).find('h2.title').text(feed.itemHeader).attr("href", feed.targetActionUrl);

                        $(htmlItem).find('div.post-description p').html(feed.itemDetail);

                        $(htmlItem).find('div.post-description img').addClass("col-md-12");

                        // 1: Ask question, 2: Answer, 3: Upvote, 4: Comment, 5: Mark as Answer, 
                        // 6: Register as new user, 7: Follow an user, 8: Follow a question, 9: Update profile image
                        if (feed.activityType == 6 || feed.activityType == 7) {
                            $(htmlItem).find('div.thread-details').hide();
                        }

                        if (feed.activityType == 1 || feed.activityType == 8) {
                            $(htmlItem).find('.follow-ul').show();
                            var followButton = $(htmlItem).find('.follow-ul a.thumbs');
                            $(followButton).click(function(){
                                var button = $(this);
                                var textSpan = $(button).find('span');
                                var icon = $(button).find('i.fa');
                                if($(button).hasClass('active'))
                                {
                                    $(button).removeClass('active');
                                    $(textSpan).text('Follow');
                                    $(icon).removeClass('fa-check').addClass('fa-circle-plus');
                                }
                                else
                                {
                                    $(button).addClass('active');
                                    $(textSpan).text('Following');
                                    $(icon).removeClass('fa-circle-plus').addClass('fa-check');
                                }
                            });
                        }

                        if (feed.activityType == 2 || feed.activityType == 5) {
                            $(htmlItem).find('.upvote-ul').show();
                            var upvoteButton = $(htmlItem).find('.follow-ul a.thumbs');
                            $(upvoteButton).click(function(){
                                var button = $(this);
                                var textSpan = $(button).find('span');
                                
                                if($(button).hasClass('active'))
                                {
                                    $(button).removeClass('active');
                                    $(textSpan).text('Upvote');
                                }
                                else
                                {
                                    $(button).addClass('active');
                                    $(textSpan).text('Upvoted');
                                }
                            });
                        }

                        $(htmlItem).find('span.view-count').text(feed.viewCount + " views");
                        $(htmlItem).find('span.answer-count').text(feed.answersCount + " answers");
                        $(htmlItem).find('span.post-pub-time').text(getDateFormattedByMonthYear(feed.postedDateInUTC));

                        if (!page) {
                            $("div.feed-list").append(htmlItem);
                        }
                        else
                        {
                            $(htmlItem).insertBefore("div.row.load:not('.hide')");
                        }
                    }
                });

                if (!page) {
                    var loadMoreDiv = $("div.feed-list .load").clone().removeClass('hide');
                    $("div.feed-list").append(loadMoreDiv);

                    $('a.loadMore').click(function (event) {
                        event.preventDefault();

                        $('.toggleThis.loadlabel').hide();
                        $('.toggleThis.spinner').show();

                        var currentPage = parseInt($('#currentPage').val());
                        loadFeeds(currentPage + 1);
                    });

                    $("#loading").hide();
                }
                else
                {
                    $('.toggleThis.loadlabel').show();
                    $('.toggleThis.spinner').hide();
                }
            }
        });
    }
</script>


    <div class="container">       
        
            <div class="col-xs-12 col-md-9 left-side feed-list">
                <div id="loading">
                    <i class="fa fa-refresh fa-spin fa-2x"></i><span>Please wait while we prepare your feed...</span>
                </div>
                <div class="row item hide">
                    <div class="col-xs-12 thread">
                        <div class="row">
                            <div class="col-xs-12">
                                <div class="row post-header">
                                    <div class="col-sm-10 col-xs-8 headers-col">

                                        <div class="profile-img-col hidden-xs">
                                            <a href="#" class="post-creator-image"></a>
                                        </div>
                                        <p class="header-text-content ">
                                            <a href="#" class="name-link">Pritam Karmakar</a>
                                            <span class="action"> asked a</span>
                                            <a href="#" class="type-link discussion target">Question</a>
                                        </p>
                                        <p class="tagline-text-content designation"></p>
                                    </div>

                                </div>
                                <div class="row">
                                    <div class="col-xs-12 col-md-12 ">
                                        <h2 class="title">
                                            <a href="#">Need help to create shibpurhub animated video</a>
                                        </h2>

                                        <div class="post-description">
                                            <p>
                                                We have to create animated product video for ShibpurHub website. Can someone take this responsibility? Here are some websites that we can use to create free video -http://wideo.co/ https://goanimate.comhttps://www.powtoon.com
                                            </p>
                                        </div>
                                    </div>
                                </div>
                            </div>
                        </div>

                        <div class="row thread-details">
                            <div class="thread-details-container">
                                <div class="col-xs-12 col-md-7">
                                    <ul class="list-inline pull-left upvote-ul">
                                        <li>
                                            <a href="#" class="thumbs" data-allowed="true"><i class="fa fa-arrow-up"></i> <span>Upvote</span></a>
                                        </li>
                                    </ul>
                                    <ul class="list-inline pull-left follow-ul">
                                        <li>
                                            <a href="#" class="thumbs" data-allowed="true"><i class="fa fa-plus-circle"></i> <span>Follow</span></a>
                                        </li>
                                    </ul>
                                </div>
                                <div class="col-xs-12 col-md-5">
                                    <ul class="extra-details pull-right list-inline">
                                        <li>
                                            <span class="view-count"></span>
                                        </li>

                                        <li>
                                            <span class="answer-count"></span>
                                        </li>

                                        <li>
                                            <span class="post-pub-time">Jul 31, 2015</span>
                                        </li>
                                    </ul>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>

                <div class="row load hide">
                    <div class="col-xs-12 thread text-center loadMoreContainer">
                        <a href="#" class="loadMore" id="loadMoreBtn">
                            <span class="toggleThis loadlabel" style="display: inline;">Load More</span>
                            <span class="toggleThis spinner" style="display: none;"><i class="fa fa-spinner fa-spin fa-fw"></i> Loading more..</span>
                        </a>
                    </div>
                </div>
            </div>
            <div class="col-xs-12 col-md-3">
                @Html.Partial("~/Views/PartialViews/_LeaderBoard.cshtml")
                @Html.Partial("~/Views/PartialViews/_PopularTags.cshtml")
                @Html.Partial("~/Views/PartialViews/_PopularQuestions.cshtml")
            </div>
        <input type="hidden" id="currentPage" value="0" />
        <input type="hidden" id="alreadyShown" value="0" />
    </div>

