@model ShibpurConnectWebApp.Models.FeedViewModel
@{
    ViewBag.Title = "Feed";
}

<style type="text/css">
    div.main {
        float: left;
        position: relative;
        padding-left: 10px;
    }

    #threads {
        clear: both;
        float: left;
        margin-bottom: 20px;
    }

    div.thread {
        padding: 12px 0 10px 0;
        border-bottom: 1px solid #e0e0e0;
        padding: 15px 0;
        float: left;
    }

    div.user {
        width: 70px;
        text-align: center;
        height: 70px;
        display: block;
        float: left;
        margin-right: 12px;
    }

    .avatar {
        border-radius: 50%;
        width: 40px;
        height: 40px;
        background-color: #CCCCCA;
        cursor: pointer;
        -webkit-transition: opacity ease-in-out .25s 0s;
        -moz-transition: opacity ease-in-out .25s 0s;
        -o-transition: opacity ease-in-out .25s 0s;
        transition: opacity ease-in-out .25s 0s;
    }

    div.detail {
        float: left;
    }

    .detail h3 {
        font-size: 20px;
        line-height: 1.4;
        margin-bottom: .5em;
        margin-top: 0;
    }

    .tags {
        padding: 0;
        margin-top: 2%;
    }
    .post-tag {
        color: #566e76;
        background: #f7fdff;
        border: 1px solid #c0d4db;
        padding: .4em .5em;
        border-radius: 15px;
        text-align: center;
        font-size: 11px;
        line-height: 1;
        color: #3e6d8e;
        background-color: #e4edf4;
        margin: 2px 2px 2px 0;
        text-decoration: none;
        font-size: 12px;
        white-space: nowrap;
        display: inline-block;
        border-radius: 0;
        border: 1px solid #e4edf4;
    }
    a:visited {
        color: #0c65a5;
    }
    div.stat
    {
        color: #808080;
    }

    div.stat span
    {
        display: inline-block;
        width: 100%;
    }

    footer {
        float: left;
        clear: both;
    }
    
</style>

@Scripts.Render("~/bundles/jquery")
<script type="text/javascript">
    function getMonth(month)
    {
        var monthArray = {
            "0": "Jan",
            "1": "Feb",
            "2": "Mar",
            "3": "Apr",
            "4": "May",
            "5": "Jun",
            "6": "Jul",
            "7": "Aug",
            "8": "Sep",
            "9": "Oct",
            "10": "Nov",
            "11": "Dec",
        }

        return monthArray[month];
    }

    $(document).ready(function () {
        jQuery.support.cors = true;
        var SERVER = "http://shibpur.azurewebsites.net/api/";
        var token = localStorage.getItem("TOKEN") || "PTLp2jwqIgLZmDBqjtADmHdtHmKpEmy-KtrdrocIBR5dz2k0uHNdgLdeqm6bFODmjUxsgNkcr0LI2UGaT6xve1gxPaHjLAyqneD69pKNIVwpo6mGtiaemzfJFVgV_FS_Q6TzA5InNb16tGCu3VNoYdqQEJu-jLiX3uN3FNAjAUKElpYZbjk5fYZ7ZKZ3T0w7utu0rbNI2BWuxo4HADZ4wrvI1J_-8qnd4Sq1kYWBkdPFeqDO2HQ8Io-IiKSDmnFS";
        
        $.ajax({
            url: SERVER + "questions/GetQuestions",
            type: "GET",
            dataType: "json",
            contentType: "application/json",
            headers: {          
                Accept: "application/json",
                "Content-Type": "application/json",
            },     
            beforeSend: function (xhr) {
                xhr.setRequestHeader("Authorization", "Bearer " + token);
            },
            success: function (result) {
                if (!result) {
                    return;
                }

                var questions = result;
                $(questions).each(function (index, question) {
                    var thread = $('div.thread.hide').clone();
                    var utcDate = new Date(question.postedOnUtc);
                    var dateString = getMonth(utcDate.getMonth().toString()) + " " + utcDate.getDate() + " '" + utcDate.getFullYear().toString().substr(2,2);;

                    $(thread).removeClass('hide');
                    $(thread).find('div.user span.userName').text(question.userId);
                    $(thread).find('div.detail h3 a').text(question.title).attr('href', '/Feed/Details/' + question.questionId);
                    $(thread).find('div.detail .excerpt').text(question.description);
                    $(thread).find('div.stat span.date').text(dateString);
                    $(thread).find('div.stat span.answercount').text((question.comments || "0") + " answers");

                    if (question.categories)
                    {
                        $(question.categories).each(function (i, category) {
                            $('<a>').addClass('post-tag').text(category).attr('href', "/Feed/Categories/" + category);
                        });
                    }
                    
                    $('#threads').append(thread);
                });
            }
        });
    });
</script>

<div class="main">
    <div id="threads">     

        <div class="hide thread col-md-10">
            <div class="user">
                <img class="avatar" width="40" height="40" src="/Content/images/profile-image.jpg">
                <span class="userName"></span>
            </div>
            <div class="detail col-md-10">
                <h3>
                    <a href="#"></a>
                </h3>
                <div class="excerpt">
                    
                </div>
                <div class="tags col-md-10">
                </div>
                <div class="stat col-md-2">
                    <span class="date"></span>
                    <span class="answercount"></span>
                </div>
            </div>
        </div>
</div>
    <div id="disqus_thread"></div>
    <script type="text/javascript">
        /* * * CONFIGURATION VARIABLES: EDIT BEFORE PASTING INTO YOUR WEBPAGE * * */
        var disqus_shortname = 'pritam83'; // required: replace example with your forum shortname

        /* * * DON'T EDIT BELOW THIS LINE * * */
        (function() {
            var dsq = document.createElement('script'); dsq.type = 'text/javascript'; dsq.async = true;
            dsq.src = '//' + disqus_shortname + '.disqus.com/embed.js';
            (document.getElementsByTagName('head')[0] || document.getElementsByTagName('body')[0]).appendChild(dsq);
        })();
    </script>
    <noscript>Please enable JavaScript to view the <a href="https://disqus.com/?ref_noscript">comments powered by Disqus.</a></noscript>

</div>